jobs:
  build:
    name: Issue metrics
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Get dates for last month
      run: '# Calculate the first day of the previous month

        first_day=$(date -d "last month" +%Y-%m-01)


        # Calculate the last day of the previous month

        last_day=$(date -d "$first_day +1 month -1 day" +%Y-%m-%d)


        # Set an environment variable with the date range

        echo "last_month=$first_day..$last_day" >> "$GITHUB_ENV"

        '
      shell: bash
    - continue-on-error: true
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        SEARCH_QUERY: repo:awsdocs/aws-doc-sdk-examples is:issue created:${{ env.last_month
          }} -reason:"not planned"
      name: Run issue-metrics tool
      uses: github/issue-metrics@v2
    - continue-on-error: true
      name: Create issue
      uses: peter-evans/create-issue-from-file@v5
      with:
        content-filepath: ./issue_metrics.md
        title: Monthly issue metrics report  ${{ env.last_month }}
        token: ${{ secrets.GITHUB_TOKEN }}
name: Monthly issue metrics
on:
  repository_dispatch:
    types: trigger-ga___issue-metrics.yml
permissions:
  issues: write
  pull-requests: read
